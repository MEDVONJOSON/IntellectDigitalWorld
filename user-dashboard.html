<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Learning Dashboard - INTELLECT DIGITAL WORLD</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="img/favicon.ico" rel="icon">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem 0;
        }
        .course-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            border-radius: 15px;
            overflow: hidden;
        }
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .progress-ring {
            width: 60px;
            height: 60px;
        }
        .progress-ring circle {
            fill: transparent;
            stroke-width: 4;
        }
        .progress-ring .progress-circle {
            stroke: #28a745;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        .progress-ring .background-circle {
            stroke: #e9ecef;
        }
        .sidebar {
            background: #f8f9fa;
            min-height: calc(100vh - 76px);
            border-right: 1px solid #dee2e6;
        }
        .nav-link {
            color: #495057;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.25rem;
        }
        .nav-link:hover, .nav-link.active {
            background: var(--primary);
            color: white;
        }
        .badge-custom {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 20px;
            padding: 0.5rem 1rem;
        }
        .lesson-item {
            border-left: 3px solid #e9ecef;
            padding-left: 1rem;
            margin-bottom: 0.5rem;
        }
        .lesson-item.completed {
            border-left-color: #28a745;
        }
        .lesson-item.current {
            border-left-color: var(--primary);
            background: rgba(248, 15, 15, 0.08);
        }
        .navbar, .bg-primary, header, .site-header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%) !important;
            color: #fff;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="img/logo.jpg" alt="INTELLECT DIGITAL WORLD" style="height: 100px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="course-catalog.html">Courses</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i> <span id="userName">Student</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2">Welcome back, <span id="welcomeName">Student</span>!</h1>
                    <p class="mb-0">Continue your learning journey and achieve your goals</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex justify-content-end align-items-center">
                        <div class="me-3">
                            <h4 class="mb-0" id="totalCourses">0</h4>
                            <small>Courses Enrolled</small>
                        </div>
                        <div class="me-3">
                            <h4 class="mb-0" id="completedCourses">0</h4>
                            <small>Completed</small>
                        </div>
                        <div>
                            <h4 class="mb-0" id="totalHours">0</h4>
                            <small>Hours Learned</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-0">
                <div class="p-3">
                    <h6 class="text-muted mb-3">DASHBOARD</h6>
                    <nav class="nav flex-column">
                        <a class="nav-link active" href="#" data-section="overview">
                            <i class="fas fa-tachometer-alt me-2"></i>Overview
                        </a>
                        <a class="nav-link" href="#" data-section="my-courses">
                            <i class="fas fa-book me-2"></i>My Courses
                        </a>
                        <a class="nav-link" href="#" data-section="certificates">
                            <i class="fas fa-certificate me-2"></i>Certificates
                        </a>
                        <a class="nav-link" href="#" data-section="progress">
                            <i class="fas fa-chart-line me-2"></i>Progress
                        </a>
                        <a class="nav-link" href="#" data-section="profile">
                            <i class="fas fa-user me-2"></i>Profile
                        </a>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 p-4">
                <!-- Overview Section -->
                <div id="overview-section" class="dashboard-section">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h3>Continue Learning</h3>
                            <p class="text-muted">Pick up where you left off</p>
                        </div>
                    </div>
                    <div class="row" id="continueLearningCards">
                        <!-- Continue learning cards will be populated here -->
                </div>

                    <div class="row mt-5">
                        <div class="col-12">
                            <h3>Recent Activity</h3>
                            <div class="card">
                    <div class="card-body">
                                    <div id="recentActivity">
                                        <!-- Recent activity will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Courses Section -->
                <div id="my-courses-section" class="dashboard-section d-none">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h3>My Courses</h3>
                            <p class="text-muted">All your enrolled courses</p>
                        </div>
                    </div>
                    <div class="row" id="myCoursesGrid">
                        <!-- Course cards will be populated here -->
                    </div>
                </div>

                <!-- Certificates Section -->
                <div id="certificates-section" class="dashboard-section d-none">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h3>Certificates</h3>
                            <p class="text-muted">Your completed course certificates</p>
                        </div>
                    </div>
                    <div class="row" id="certificatesGrid">
                        <!-- Certificates will be populated here -->
                    </div>
                </div>

                <!-- Progress Section -->
                <div id="progress-section" class="dashboard-section d-none">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h3>Learning Progress</h3>
                            <p class="text-muted">Track your learning journey</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5>Course Completion</h5>
                                    <canvas id="completionChart" width="300" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                                    <h5>Learning Streak</h5>
                                    <div class="text-center">
                                        <h2 class="text-primary" id="learningStreak">0</h2>
                                        <p class="text-muted">Days in a row</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Section -->
                <div id="profile-section" class="dashboard-section d-none">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h3>My Profile</h3>
                            <p class="text-muted">View and manage your account information</p>
                            <div class="alert alert-info d-flex align-items-center" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                <div>
                                    <strong>Demo Mode:</strong> A demo account has been created for you. Click "Edit Profile" to test the profile editing functionality.
                                    <br><small class="text-muted">Email: student@demo.com | Password: demo123</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="mb-3">
                                        <div class="profile-avatar mx-auto mb-3" style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                                            <i class="fas fa-user" id="profileAvatarIcon"></i>
                                        </div>
                                        <h4 id="profileName">Student Name</h4>
                                        <p class="text-muted" id="profileEmail">student@email.com</p>
                                    </div>
                                    <button class="btn btn-outline-primary btn-sm" onclick="editProfile()" id="editProfileBtn">
                                        <i class="fas fa-edit me-1"></i>Edit Profile
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Account Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">Full Name</label>
                                                <p class="form-control-plaintext" id="profileFullName">-</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">Email Address</label>
                                                <p class="form-control-plaintext" id="profileEmailAddress">-</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">Phone Number</label>
                                                <p class="form-control-plaintext" id="profilePhone">-</p>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">Date of Birth</label>
                                                <p class="form-control-plaintext" id="profileDOB">-</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">Country</label>
                                                <p class="form-control-plaintext" id="profileCountry">-</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">Member Since</label>
                                                <p class="form-control-plaintext" id="profileMemberSince">-</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Bio</label>
                                        <p class="form-control-plaintext" id="profileBio">No bio available</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-body">
                                    <h5 class="card-title">Learning Statistics</h5>
                                    <div class="row">
                                        <div class="col-md-3 text-center">
                                            <h3 class="text-primary" id="profileTotalCourses">0</h3>
                                            <p class="text-muted mb-0">Courses Enrolled</p>
                                        </div>
                                        <div class="col-md-3 text-center">
                                            <h3 class="text-success" id="profileCompletedCourses">0</h3>
                                            <p class="text-muted mb-0">Courses Completed</p>
                                        </div>
                                        <div class="col-md-3 text-center">
                                            <h3 class="text-info" id="profileTotalHours">0</h3>
                                            <p class="text-muted mb-0">Hours Learned</p>
                                        </div>
                                        <div class="col-md-3 text-center">
                                            <h3 class="text-warning" id="profileCertificates">0</h3>
                                            <p class="text-muted mb-0">Certificates</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Player Modal -->
    <div class="modal fade" id="coursePlayerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="coursePlayerTitle">Course Player</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="row g-0">
                        <div class="col-md-8">
                            <div class="bg-dark text-center" style="height: 400px;">
                                <div class="d-flex align-items-center justify-content-center h-100">
                                    <div class="text-white">
                                        <i class="fas fa-play-circle fa-3x mb-3"></i>
                                        <h4>Video Player</h4>
                                        <p>Video content will be displayed here</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3">
                                <h6>Course Content</h6>
                                <div id="courseContentList">
                                    <!-- Course content will be populated here -->
                            </div>
                            </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div class="modal fade" id="profileEditModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="profileEditForm" onsubmit="handleProfileFormSubmit(event)">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="editName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editEmail" class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="editEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editPhone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="editPhone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editDOB" class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" id="editDOB">
                                </div>
                                <div class="mb-3">
                                    <label for="editCountry" class="form-label">Country</label>
                                    <select class="form-select" id="editCountry">
                                        <option value="">Select Country</option>
                                        <option value="Sierra Leone">Sierra Leone</option>
                                        <option value="Nigeria">Nigeria</option>
                                        <option value="Ghana">Ghana</option>
                                        <option value="Liberia">Liberia</option>
                                        <option value="Gambia">Gambia</option>
                                        <option value="Guinea">Guinea</option>
                                        <option value="United States">United States</option>
                                        <option value="United Kingdom">United Kingdom</option>
                                        <option value="Canada">Canada</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editBio" class="form-label">Bio</label>
                            <textarea class="form-control" id="editBio" rows="3" placeholder="Tell us about yourself..."></textarea>
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Sample course data
        const sampleCourses = [
            {
                id: 1,
                title: "Web Development Fundamentals",
                instructor: "Med Vonjoson",
                duration: "8 weeks",
                lessons: 24,
                completedLessons: 8,
                thumbnail: "img/course-1.jpg",
                description: "Learn HTML, CSS, and JavaScript from scratch",
                difficulty: "Beginner",
                rating: 4.8,
                enrolledDate: "2024-01-15",
                lastAccessed: "2024-01-20"
            },
            {
                id: 2,
                title: "Advanced JavaScript & React",
                instructor: "Ibrahim S Swaray",
                duration: "12 weeks",
                lessons: 36,
                completedLessons: 12,
                thumbnail: "img/course-2.jpg",
                description: "Master modern JavaScript and React development",
                difficulty: "Intermediate",
                rating: 4.9,
                enrolledDate: "2024-01-10",
                lastAccessed: "2024-01-19"
            },
            {
                id: 3,
                title: "Digital Marketing Mastery",
                instructor: "Shalom DC Alabi",
                duration: "10 weeks",
                lessons: 30,
                completedLessons: 30,
                thumbnail: "img/course-3.jpg",
                description: "Complete digital marketing strategy and implementation",
                difficulty: "Beginner",
                rating: 4.7,
                enrolledDate: "2023-12-01",
                lastAccessed: "2024-01-18",
                completed: true
            }
        ];

        // Create demo user for testing
        function createDemoUserIfNeeded() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            // If no users exist, create a demo user
            if (users.length === 0) {
                const demoUser = {
                    id: Date.now(),
                    name: 'Demo Student',
                    email: 'student@demo.com',
                    password: 'demo123',
                    phone: '+232 78091467',
                    dateOfBirth: '1995-01-15',
                    country: 'Sierra Leone',
                    bio: 'I am a passionate learner interested in web development and digital marketing.',
                    createdAt: new Date().toISOString(),
                    avatar: ''
                };
                
                users.push(demoUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Auto-login the demo user
                localStorage.setItem('currentUser', JSON.stringify({
                    id: demoUser.id,
                    name: demoUser.name,
                    email: demoUser.email,
                    avatar: demoUser.avatar,
                    bio: demoUser.bio,
                    phone: demoUser.phone,
                    dateOfBirth: demoUser.dateOfBirth,
                    country: demoUser.country
                }));
                
                console.log('Demo user created and logged in automatically');
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Create demo user if none exists
            createDemoUserIfNeeded();
            
            // Require auth
            try { if (window.Auth && Auth.requireAuthOrRedirect) Auth.requireAuthOrRedirect(); } catch (_) {}
            initializeDashboard();
            loadUserData();
            loadCourses();
            setupNavigation();
            
            // Make functions globally accessible
            window.editProfile = editProfile;
            window.handleProfileFormSubmit = handleProfileFormSubmit;
            console.log('Dashboard initialized, functions available globally');
            
            // Add alternative click handler for edit profile button
            const editProfileBtn = document.getElementById('editProfileBtn');
            if (editProfileBtn) {
                editProfileBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Edit profile button clicked via event listener');
                    editProfile();
                });
                console.log('Alternative click handler added to edit profile button');
                
                // Test if button is clickable
                console.log('Edit profile button found and ready:', editProfileBtn);
            } else {
                console.log('Edit profile button not found');
            }
            
            // Attach form submission handler
            const profileEditForm = document.getElementById('profileEditForm');
            if (profileEditForm) {
                profileEditForm.addEventListener('submit', handleProfileFormSubmit);
                console.log('Profile edit form submission handler attached');
            } else {
                console.log('Profile edit form not found');
            }
        });

        function initializeDashboard() {
            // Set user name
            const userName = localStorage.getItem('userName') || 'Student';
            document.getElementById('userName').textContent = userName;
            document.getElementById('welcomeName').textContent = userName;

            // Calculate stats
            const totalCourses = sampleCourses.length;
            const completedCourses = sampleCourses.filter(course => course.completed).length;
            const totalHours = sampleCourses.reduce((total, course) => {
                return total + (course.completedLessons * 0.5); // Assuming 30 min per lesson
            }, 0);

            document.getElementById('totalCourses').textContent = totalCourses;
            document.getElementById('completedCourses').textContent = completedCourses;
            document.getElementById('totalHours').textContent = Math.round(totalHours);
        }

        function loadCourses() {
            loadContinueLearning();
            loadMyCourses();
            loadCertificates();
        }

        function loadContinueLearning() {
            const container = document.getElementById('continueLearningCards');
            const current = window.Auth && Auth.getCurrentUser ? Auth.getCurrentUser() : null;
            const enrollKey = current ? 'enrollments:' + current.id : null;
            const enrollments = enrollKey ? JSON.parse(localStorage.getItem(enrollKey) || '[]') : [];
            const inProgressCourses = enrollments.length ? enrollments.map(e => ({
                id: e.id,
                title: e.title,
                description: '',
                duration: '',
                lessons: e.lessons || 0,
                completedLessons: e.completedLessons || 0
            })) : sampleCourses.filter(course => !course.completed);

            container.innerHTML = '';
            inProgressCourses.forEach(course => {
                const progressPercentage = (course.completedLessons / course.lessons) * 100;
                const card = createCourseCard(course, progressPercentage, true);
                container.appendChild(card);
            });
        }

        function loadMyCourses() {
            const container = document.getElementById('myCoursesGrid');
            container.innerHTML = '';
            const current = window.Auth && Auth.getCurrentUser ? Auth.getCurrentUser() : null;
            const enrollKey = current ? 'enrollments:' + current.id : null;
            const enrollments = enrollKey ? JSON.parse(localStorage.getItem(enrollKey) || '[]') : [];
            const list = enrollments.length ? enrollments : sampleCourses;

            list.forEach(course => {
                const lessons = course.lessons || 1;
                const completedLessons = course.completedLessons || 0;
                const progressPercentage = (completedLessons / lessons) * 100;
                const normalizedCourse = Object.assign({ description: '', duration: '' }, course);
                const card = createCourseCard(normalizedCourse, progressPercentage, false);
                container.appendChild(card);
            });
        }

        function loadCertificates() {
            const container = document.getElementById('certificatesGrid');
            const completedCourses = sampleCourses.filter(course => course.completed);

            container.innerHTML = '';
            completedCourses.forEach(course => {
                const certificateCard = createCertificateCard(course);
                container.appendChild(certificateCard);
            });
        }

        function createCourseCard(course, progressPercentage, isContinueLearning = false) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 mb-4';

            col.innerHTML = `
                <div class="card course-card h-100">
                    <img src="${course.thumbnail}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="${course.title}">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="badge badge-custom">${course.difficulty}</span>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-star text-warning me-1"></i>
                                <small>${course.rating}</small>
                            </div>
                        </div>
                        <h5 class="card-title">${course.title}</h5>
                        <p class="card-text text-muted small">${course.description}</p>
                        <div class="mt-auto">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="text-muted">Progress</small>
                                <small class="text-muted">${course.completedLessons}/${course.lessons} lessons</small>
                            </div>
                            <div class="progress mb-3" style="height: 6px;">
                                <div class="progress-bar" style="width: ${progressPercentage}%"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-primary btn-sm" onclick="openCoursePlayer(${course.id})">
                                    ${isContinueLearning ? 'Continue' : 'View Course'}
                                </button>
                                <small class="text-muted">${course.duration}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            return col;
        }

        function createCertificateCard(course) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 mb-4';

            col.innerHTML = `
                <div class="card course-card h-100">
                    <div class="card-body text-center d-flex flex-column">
                        <div class="mt-auto mb-3">
                            <i class="fas fa-certificate fa-4x text-warning mb-3"></i>
                            <h5>${course.title}</h5>
                            <p class="text-muted small">Completed on ${new Date(course.lastAccessed).toLocaleDateString()}</p>
                        </div>
                        <div class="mt-auto">
                            <button class="btn btn-outline-primary btn-sm me-2" onclick="viewCertificate(${course.id})">
                                View Certificate
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="downloadCertificate(${course.id})">
                                Download
                            </button>
                        </div>
                    </div>
                </div>
            `;

            return col;
        }

        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link[data-section]');
            const sections = document.querySelectorAll('.dashboard-section');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
            e.preventDefault();
                    const targetSection = this.getAttribute('data-section');

                    // Remove active class from all nav links
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    // Add active class to clicked nav link
                    this.classList.add('active');

                    // Hide all sections
                    sections.forEach(section => section.classList.add('d-none'));
                    // Show target section
                    document.getElementById(targetSection + '-section').classList.remove('d-none');
                });
            });
        }

        function openCoursePlayer(courseId) {
            // Redirect to the course player page
            window.location.href = `course-player.html?course=${courseId}`;
        }

        function viewCertificate(courseId) {
            alert('Certificate viewer will open here');
        }

        function downloadCertificate(courseId) {
            alert('Certificate download will start here');
        }

        function logout() {
            localStorage.removeItem('userAuthToken');
            localStorage.removeItem('userName');
            window.location.href = 'index.html';
        }

        function loadUserData() {
            // Load recent activity
            const recentActivity = document.getElementById('recentActivity');
            recentActivity.innerHTML = `
                <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-play-circle text-primary me-3"></i>
                    <div>
                        <div class="fw-bold">Completed Lesson 8 in Web Development Fundamentals</div>
                        <small class="text-muted">2 hours ago</small>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-certificate text-warning me-3"></i>
                    <div>
                        <div class="fw-bold">Earned certificate in Digital Marketing Mastery</div>
                        <small class="text-muted">1 day ago</small>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-book text-success me-3"></i>
                    <div>
                        <div class="fw-bold">Enrolled in Advanced JavaScript & React</div>
                        <small class="text-muted">3 days ago</small>
                    </div>
                </div>
            `;
            
            // Load profile data
            loadProfileData();
        }

        function loadProfileData() {
            const currentUser = window.Auth && Auth.getCurrentUser ? Auth.getCurrentUser() : null;
            if (!currentUser) return;

            // Get full user data from localStorage
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const fullUserData = users.find(u => u.id === currentUser.id) || currentUser;

            // Update profile display
            document.getElementById('profileName').textContent = fullUserData.name || 'Student';
            document.getElementById('profileEmail').textContent = fullUserData.email || 'student@email.com';
            document.getElementById('profileFullName').textContent = fullUserData.name || '-';
            document.getElementById('profileEmailAddress').textContent = fullUserData.email || '-';
            document.getElementById('profilePhone').textContent = fullUserData.phone || '-';
            document.getElementById('profileDOB').textContent = fullUserData.dateOfBirth ? new Date(fullUserData.dateOfBirth).toLocaleDateString() : '-';
            document.getElementById('profileCountry').textContent = fullUserData.country || '-';
            document.getElementById('profileMemberSince').textContent = fullUserData.createdAt ? new Date(fullUserData.createdAt).toLocaleDateString() : '-';
            document.getElementById('profileBio').textContent = fullUserData.bio || 'No bio available';

            // Update learning statistics
            const enrollKey = 'enrollments:' + currentUser.id;
            const enrollments = JSON.parse(localStorage.getItem(enrollKey) || '[]');
            const totalCourses = enrollments.length || sampleCourses.length;
            const completedCourses = enrollments.filter(e => e.completed).length || sampleCourses.filter(c => c.completed).length;
            const totalHours = enrollments.reduce((total, e) => total + ((e.completedLessons || 0) * 0.5), 0) || 
                              sampleCourses.reduce((total, c) => total + (c.completedLessons * 0.5), 0);

            document.getElementById('profileTotalCourses').textContent = totalCourses;
            document.getElementById('profileCompletedCourses').textContent = completedCourses;
            document.getElementById('profileTotalHours').textContent = Math.round(totalHours);
            document.getElementById('profileCertificates').textContent = completedCourses;
        }

        function editProfile() {
            console.log('Edit profile clicked'); // Debug log
            
            // Check if user is logged in
            const currentUser = window.Auth && Auth.getCurrentUser ? Auth.getCurrentUser() : null;
            if (!currentUser) {
                console.log('No current user found - redirecting to login');
                showNotification('Please log in to edit your profile.', 'info');
                setTimeout(() => {
                    window.location.href = 'user-login.html';
                }, 2000);
                return;
            }

            console.log('Current user:', currentUser);

            // Get full user data from localStorage
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const fullUserData = users.find(u => u.id === currentUser.id) || currentUser;
            console.log('Full user data:', fullUserData);

            // Populate edit form with current data
            const editName = document.getElementById('editName');
            const editEmail = document.getElementById('editEmail');
            const editPhone = document.getElementById('editPhone');
            const editDOB = document.getElementById('editDOB');
            const editCountry = document.getElementById('editCountry');
            const editBio = document.getElementById('editBio');

            if (editName) {
                editName.value = fullUserData.name || '';
                console.log('Set name:', fullUserData.name);
            }
            if (editEmail) {
                editEmail.value = fullUserData.email || '';
                console.log('Set email:', fullUserData.email);
            }
            if (editPhone) {
                editPhone.value = fullUserData.phone || '';
                console.log('Set phone:', fullUserData.phone);
            }
            if (editDOB) {
                editDOB.value = fullUserData.dateOfBirth || '';
                console.log('Set DOB:', fullUserData.dateOfBirth);
            }
            if (editCountry) {
                editCountry.value = fullUserData.country || '';
                console.log('Set country:', fullUserData.country);
            }
            if (editBio) {
                editBio.value = fullUserData.bio || '';
                console.log('Set bio:', fullUserData.bio);
            }

            // Show the edit modal
            const modalElement = document.getElementById('profileEditModal');
            if (modalElement) {
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
                console.log('Edit profile modal opened successfully');
            } else {
                console.log('Modal element not found');
                alert('Error: Edit form not found. Please refresh the page.');
            }
        }

        function handleProfileFormSubmit(e) {
            e.preventDefault();
            console.log('Profile form submitted'); // Debug log
            
            const currentUser = window.Auth && Auth.getCurrentUser ? Auth.getCurrentUser() : null;
            if (!currentUser) {
                console.log('No current user for form submission');
                alert('Error: You must be logged in to update your profile.');
                return;
            }

            // Get form data
            const formData = {
                name: document.getElementById('editName').value.trim(),
                email: document.getElementById('editEmail').value.trim(),
                phone: document.getElementById('editPhone').value.trim(),
                dateOfBirth: document.getElementById('editDOB').value,
                country: document.getElementById('editCountry').value,
                bio: document.getElementById('editBio').value.trim()
            };

            console.log('Form data:', formData); // Debug log

            // Validate required fields
            if (!formData.name || !formData.email) {
                alert('Name and email are required fields.');
                return;
            }

            // Update user data in localStorage
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                users[userIndex] = { ...users[userIndex], ...formData };
                localStorage.setItem('users', JSON.stringify(users));
                
                // Update current user
                const updatedUser = { ...currentUser, ...formData };
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                
                // Reload profile data
                loadProfileData();
                
                // Close modal
                const modalElement = document.getElementById('profileEditModal');
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) {
                    modal.hide();
                }
                
                // Show success message
                showNotification('Profile updated successfully!', 'success');
                console.log('Profile updated successfully');
            } else {
                console.log('User not found in users array');
                showNotification('Error: User not found. Please try again.', 'error');
            }
        }

        // Enhanced notification system
        function showNotification(message, type = 'info') {
            // Remove any existing notifications
            const existingNotification = document.querySelector('.notification-toast');
            if (existingNotification) {
                existingNotification.remove();
            }

            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification-toast alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'} position-fixed`;
            notification.style.cssText = `
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                border: none;
                border-radius: 8px;
                animation: slideInRight 0.3s ease-out;
            `;
            
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                    <span>${message}</span>
                    <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;

            // Add CSS animation
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }
    </script>
</body>
</html>
