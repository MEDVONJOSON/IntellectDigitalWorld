<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Admin Login - INTELLECT DIGITAL WORLD</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <style>
.navbar, .bg-primary, header, .site-header {
    background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%) !important;
    color: #fff;
}
</style>
</head>
<body class="bg-light">
    <div class="container d-flex align-items-center justify-content-center" style="min-height: 100vh;">
        <div class="card shadow-sm" style="max-width: 420px; width: 100%;">
            <div class="card-header bg-primary text-white text-center">
                <h4 class="mb-0">Admin Login</h4>
            </div>
            <div class="card-body p-4">
                <div id="loginAlert" class="alert alert-danger d-none" role="alert"></div>
                <form id="adminLoginForm">
                    <div class="mb-3">
                        <label for="adminEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="adminEmail" placeholder="admin@example.com" required>
                    </div>
                    <div class="mb-3">
                        <label for="adminPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="Enter password" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Login</button>
                    </div>
                </form>
                <div class="text-center mt-3">
                    <small class="text-muted">Don't have an account?
                        <a href="#" id="openSignupModal" class="link-primary">Sign Up</a>
                    </small>
                </div>
            </div>
            <div class="card-footer text-center">
                <small class="text-muted">INTELLECT DIGITAL WORLD Admin Area</small>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal fade" id="signupModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Create Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="signupAlert" class="alert alert-danger d-none" role="alert"></div>
                    <form id="userSignupForm" autocomplete="off">
                        <div class="mb-3">
                            <label for="signupName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="signupName" placeholder="Your name" required>
                        </div>
                        <div class="mb-3">
                            <label for="signupEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="signupEmail" placeholder="you@example.com" required>
                        </div>
                        <div class="row g-2">
                            <div class="col-6">
                                <label for="signupPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="signupPassword" placeholder="Min 6 chars" required>
                            </div>
                            <div class="col-6">
                                <label for="signupConfirm" class="form-label">Confirm</label>
                                <input type="password" class="form-control" id="signupConfirm" placeholder="Re-type" required>
                            </div>
                        </div>
                        <div class="d-grid mt-3">
                            <button type="submit" class="btn btn-secondary">Sign Up</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function(){
            const ADMIN_TOKEN_KEY = 'adminAuthToken';
            const REQUIRED_TOKEN = 'idh-admin-2025'; // Keep in sync with applications.html
            const ADMIN_EMAIL = 'medvonjoson@gmail.com';
            const ADMIN_PASSWORD = '123456';

            // Prefill the admin email
            document.getElementById('adminEmail').value = ADMIN_EMAIL;

            document.getElementById('adminLoginForm').addEventListener('submit', function(e){
                e.preventDefault();
                const email = document.getElementById('adminEmail').value.trim();
                const password = document.getElementById('adminPassword').value;

                // Strict client-side check for the configured credentials
                if (email !== ADMIN_EMAIL || password !== ADMIN_PASSWORD) {
                    showError('Invalid credentials. Please check your email and password.');
                    return;
                }

                try {
                    localStorage.setItem(ADMIN_TOKEN_KEY, REQUIRED_TOKEN);
                    window.location.href = 'admin-dashboard.html';
                } catch (err) {
                    showError('Unable to store session. Please check your browser settings.');
                }
            });

            // Open signup modal
            document.getElementById('openSignupModal').addEventListener('click', function(e){
                e.preventDefault();
                const modal = new bootstrap.Modal(document.getElementById('signupModal'));
                modal.show();
            });

            // Handle user signup in modal
            document.getElementById('userSignupForm').addEventListener('submit', function(e){
                e.preventDefault();
                const name = document.getElementById('signupName').value.trim();
                const email = document.getElementById('signupEmail').value.trim();
                const pass = document.getElementById('signupPassword').value;
                const confirm = document.getElementById('signupConfirm').value;
                const alertBox = document.getElementById('signupAlert');
                alertBox.classList.add('d-none');

                if (!name || !/[^\s@]+@[^\s@]+\.[^\s@]+/.test(email)) {
                    return showSignupError('Please enter a valid name and email.');
                }
                if (pass.length < 6) {
                    return showSignupError('Password must be at least 6 characters.');
                }
                if (pass !== confirm) {
                    return showSignupError('Passwords do not match.');
                }
                const users = JSON.parse(localStorage.getItem('siteUsers') || '[]');
                if (users.some(u => (u.email || '').toLowerCase() === email.toLowerCase())) {
                    return showSignupError('An account with this email already exists.');
                }
                users.push({ name, email, password: pass, createdAt: new Date().toISOString() });
                localStorage.setItem('siteUsers', JSON.stringify(users));

                // Prefill login, close modal, show success
                document.getElementById('adminEmail').value = email;
                document.getElementById('adminPassword').value = pass;
                const modal = bootstrap.Modal.getInstance(document.getElementById('signupModal'));
                if (modal) modal.hide();
                const success = document.createElement('div');
                success.className = 'alert alert-success mt-3';
                success.textContent = 'Account created! You can now log in.';
                document.querySelector('.card-body').insertBefore(success, document.querySelector('.card-body').firstChild.nextSibling);
                setTimeout(() => success.remove(), 2500);
            });

            function showSignupError(msg){
                const alertBox = document.getElementById('signupAlert');
                alertBox.textContent = msg;
                alertBox.classList.remove('d-none');
            }

            function showError(msg){
                const alert = document.getElementById('loginAlert');
                alert.textContent = msg;
                alert.classList.remove('d-none');
            }
            // If already authenticated, go straight to dashboard
            document.addEventListener('DOMContentLoaded', function(){
                try {
                    if (localStorage.getItem(ADMIN_TOKEN_KEY) === REQUIRED_TOKEN) {
                        window.location.href = 'admin-dashboard.html';
                    }
                } catch (_) {}
            });

        })();
    </script>
</body>
</html>
